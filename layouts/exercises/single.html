{{ define "main" }}
<article class="pb-16 lg:pb-24">
  <!-- Hero Section -->
  <div class="bg-gradient-to-br from-pink-50 to-purple-50 py-8 lg:py-12">
    <div class="container">
      <div class="max-w-4xl">
        <!-- Breadcrumb badges -->
        <div class="flex flex-wrap items-center gap-2 mb-4">
          {{ with .Params.difficulty }}
          <a href="{{ "/difficulties/" | relLangURL }}{{ . | urlize }}/" class="px-3 py-1 text-sm font-medium rounded-full hover:ring-2 hover:ring-offset-1 transition-all
            {{ if eq . "beginner" }}bg-green-100 text-green-700 hover:ring-green-300{{ end }}
            {{ if eq . "intermediate" }}bg-yellow-100 text-yellow-700 hover:ring-yellow-300{{ end }}
            {{ if eq . "advanced" }}bg-red-100 text-red-700 hover:ring-red-300{{ end }}
            {{ if eq . "principiante" }}bg-green-100 text-green-700 hover:ring-green-300{{ end }}
            {{ if eq . "intermedio" }}bg-yellow-100 text-yellow-700 hover:ring-yellow-300{{ end }}
            {{ if eq . "avanzado" }}bg-red-100 text-red-700 hover:ring-red-300{{ end }}
          ">{{ . | title }}</a>
          {{ end }}
          {{ range .Params.equipment }}
          <a href="{{ "/equipment/" | relLangURL }}{{ . | urlize }}/" class="px-3 py-1 text-sm bg-white/80 text-gray-600 rounded-full hover:bg-pink-50 hover:text-pink-600 hover:ring-2 hover:ring-pink-200 hover:ring-offset-1 transition-all">{{ . }}</a>
          {{ end }}
        </div>

        <h1 class="text-3xl lg:text-5xl font-bold text-gray-900 mb-4">{{ .Title }}</h1>

        {{ with .Description }}
        <p class="text-xl text-gray-600 mb-6">{{ . }}</p>
        {{ end }}

        <!-- Meta info -->
        <div class="flex flex-wrap items-center gap-6 text-sm text-gray-500">
          {{ with .Params.duration }}
          <span class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            {{ div . 60 }} {{ i18n "minutes" }}
          </span>
          {{ end }}
          {{ with .Params.muscles }}
          <span class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            <span class="flex flex-wrap gap-1">
              {{ range $i, $muscle := . }}{{ if $i }}<span class="text-gray-400">,</span> {{ end }}<a href="{{ "/muscles/" | relLangURL }}{{ $muscle | urlize }}/" class="hover:text-pink-600 transition-colors">{{ $muscle }}</a>{{ end }}
            </span>
          </span>
          {{ end }}
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container py-8 lg:py-12">
    <div class="grid lg:grid-cols-3 gap-8 lg:gap-12">
      <!-- Left: Video + Content -->
      <div class="lg:col-span-2">
        <!-- Video -->
        {{ with .Params.video_id }}
        <div class="mb-8">
          <div class="video-wrapper rounded-xl overflow-hidden shadow-lg">
            <lite-youtube
              videoid="{{ . }}"
              playlabel="{{ i18n "play_video" }}: {{ $.Title }}"
              style="background-image: url('https://i.ytimg.com/vi/{{ . }}/hqdefault.jpg');"
            >
              <a href="https://youtube.com/watch?v={{ . }}" class="lty-playbtn" title="{{ $.Title }}">
                <span class="lyt-visually-hidden">{{ $.Title }}</span>
              </a>
            </lite-youtube>
          </div>
        </div>
        {{ else }}
        <!-- Recommended Videos Section -->
        {{/* Look up exercise data from exercises.json */}}
        {{ $filename := .File.BaseFileName }}
        {{/* Handle "the-" prefix in filenames like "the-hundred" -> "hundred" */}}
        {{ $exerciseId := $filename | replaceRE "^the-" "" }}
        {{ $exerciseData := false }}
        {{ range $.Site.Data.exercises.exercises }}
          {{ if eq .id $exerciseId }}
            {{ $exerciseData = . }}
          {{ end }}
        {{ end }}

        {{ if and $exerciseData $exerciseData.recommended_videos }}
        <div class="mb-8 bg-gradient-to-br from-pink-50 to-purple-50 rounded-xl p-6 border border-pink-100">
          <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
            <svg class="w-5 h-5 text-pink-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
              <polygon fill="white" points="9.545,15.568 15.818,12 9.545,8.432"/>
            </svg>
            {{ i18n "recommended_videos" | default "Recommended Videos" }}
          </h3>

          <div class="grid gap-4 sm:grid-cols-2">
            {{ range $exerciseData.recommended_videos }}
            <a href="https://www.youtube.com/watch?v={{ .id }}" target="_blank" rel="noopener" class="flex gap-3 bg-white rounded-lg p-3 border border-gray-100 hover:border-pink-200 hover:shadow-md transition-all group">
              <div class="relative w-28 flex-shrink-0">
                <img src="https://i.ytimg.com/vi/{{ .id }}/mqdefault.jpg" alt="{{ .title }}" class="w-full h-16 object-cover rounded group-hover:opacity-90 transition-opacity" loading="lazy" />
                <span class="absolute inset-0 flex items-center justify-center">
                  <span class="w-8 h-8 bg-pink-600/90 rounded-full flex items-center justify-center group-hover:scale-110 transition-transform">
                    <svg class="w-3 h-3 text-white ml-0.5" fill="currentColor" viewBox="0 0 24 24"><polygon points="5,3 19,12 5,21"/></svg>
                  </span>
                </span>
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="text-sm font-medium text-gray-900 line-clamp-2 group-hover:text-pink-600 transition-colors">{{ .title }}</h4>
                <p class="text-xs text-gray-500 mt-1">{{ .channel }}</p>
              </div>
            </a>
            {{ end }}
          </div>

          <!-- Direct YouTube search fallback -->
          <div class="pt-4 mt-4 border-t border-pink-200">
            <a href="https://www.youtube.com/results?search_query=pilates+{{ $.Title | urlquery }}+tutorial" target="_blank" rel="noopener" class="inline-flex items-center gap-2 text-sm text-pink-600 hover:text-pink-700 font-medium">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
                <polygon fill="white" points="9.545,15.568 15.818,12 9.545,8.432"/>
              </svg>
              Search YouTube for more "{{ $.Title }}" tutorials
              <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
            </a>
          </div>
        </div>
        {{ else }}
        <!-- Fallback: Direct YouTube search only -->
        <div class="mb-8 bg-gradient-to-br from-pink-50 to-purple-50 rounded-xl p-6 border border-pink-100">
          <h3 class="text-lg font-semibold text-gray-900 mb-3 flex items-center gap-2">
            <svg class="w-5 h-5 text-pink-600" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
              <polygon fill="white" points="9.545,15.568 15.818,12 9.545,8.432"/>
            </svg>
            {{ i18n "find_video_tutorials" | default "Find Video Tutorials" }}
          </h3>
          <p class="text-gray-600 text-sm mb-4">{{ i18n "video_search_tip" | default "Search YouTube for tutorials on this exercise:" }}</p>
          <a href="https://www.youtube.com/results?search_query=pilates+{{ $.Title | urlquery }}+tutorial" target="_blank" rel="noopener" class="inline-flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/>
              <polygon fill="white" points="9.545,15.568 15.818,12 9.545,8.432"/>
            </svg>
            Search "{{ $.Title }}" on YouTube
          </a>
        </div>
        {{ end }}
        {{ end }}

        <!-- Content -->
        <div class="prose prose-lg prose-pink max-w-none">
          {{ .Content }}
        </div>

        <!-- Steps -->
        {{ with .Params.steps }}
        <section class="mt-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">{{ i18n "how_to_perform" }}</h2>
          <ol class="space-y-4">
            {{ range $index, $step := . }}
            <li class="flex gap-4">
              <span class="flex-shrink-0 w-8 h-8 bg-pink-600 text-white rounded-full flex items-center justify-center font-bold text-sm">
                {{ add $index 1 }}
              </span>
              <p class="text-gray-700 pt-1">{{ $step }}</p>
            </li>
            {{ end }}
          </ol>
        </section>
        {{ end }}

        <!-- Modifications -->
        {{ with .Params.modifications }}
        <section class="mt-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">{{ i18n "modifications" }}</h2>
          <div class="grid gap-4 sm:grid-cols-2">
            {{ range . }}
            <div class="bg-gray-50 rounded-xl p-5">
              <div class="flex items-center gap-2 mb-2">
                <span class="px-2 py-1 text-xs font-medium rounded
                  {{ if eq .level "easier" }}bg-green-100 text-green-700{{ end }}
                  {{ if eq .level "harder" }}bg-orange-100 text-orange-700{{ end }}
                  {{ if eq .level "más fácil" }}bg-green-100 text-green-700{{ end }}
                  {{ if eq .level "más difícil" }}bg-orange-100 text-orange-700{{ end }}
                ">{{ .level }}</span>
                <h3 class="font-semibold text-gray-900">{{ .name }}</h3>
              </div>
              <p class="text-gray-600">{{ .description }}</p>
            </div>
            {{ end }}
          </div>
        </section>
        {{ end }}

        <!-- FAQ -->
        {{ with .Params.faq }}
        <section class="mt-12">
          <h2 class="text-2xl font-bold text-gray-900 mb-6">{{ i18n "faq" }}</h2>
          <div class="space-y-3">
            {{ range . }}
            <details class="group bg-gray-50 rounded-xl">
              <summary class="flex items-center justify-between p-5 cursor-pointer font-medium text-gray-900">
                {{ .q }}
                <svg class="w-5 h-5 text-gray-500 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </summary>
              <div class="px-5 pb-5 text-gray-600">
                {{ .a }}
              </div>
            </details>
            {{ end }}
          </div>
        </section>
        {{ end }}
      </div>

      <!-- Right: Sidebar -->
      <aside class="lg:col-span-1">
        <div class="sticky top-20 space-y-6">
          <!-- Quick Info Card -->
          <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm">
            <h3 class="font-semibold text-gray-900 mb-4">{{ i18n "quick_info" }}</h3>
            <dl class="space-y-3 text-sm">
              {{ with .Params.difficulty }}
              <div class="flex justify-between">
                <dt class="text-gray-500">{{ i18n "difficulty" }}</dt>
                <dd class="font-medium"><a href="{{ "/difficulties/" | relLangURL }}{{ . | urlize }}/" class="hover:text-pink-600 transition-colors">{{ . | title }}</a></dd>
              </div>
              {{ end }}
              {{ with .Params.duration }}
              <div class="flex justify-between">
                <dt class="text-gray-500">{{ i18n "duration" }}</dt>
                <dd class="font-medium">{{ div . 60 }} {{ i18n "min" }}</dd>
              </div>
              {{ end }}
              {{ with .Params.equipment }}
              <div class="flex justify-between">
                <dt class="text-gray-500">{{ i18n "equipment" }}</dt>
                <dd class="font-medium">{{ range $i, $e := . }}{{ if $i }}, {{ end }}<a href="{{ "/equipment/" | relLangURL }}{{ $e | urlize }}/" class="hover:text-pink-600 transition-colors">{{ $e }}</a>{{ end }}</dd>
              </div>
              {{ end }}
              {{ with .Params.muscles }}
              <div class="flex justify-between items-start">
                <dt class="text-gray-500">{{ i18n "muscles" }}</dt>
                <dd class="font-medium text-right">{{ range $i, $m := . }}{{ if $i }}, {{ end }}<a href="{{ "/muscles/" | relLangURL }}{{ $m | urlize }}/" class="hover:text-pink-600 transition-colors">{{ $m }}</a>{{ end }}</dd>
              </div>
              {{ end }}
            </dl>
          </div>

          <!-- Used in Workouts -->
          {{ $exerciseTitle := .Title | lower }}
          {{ $usedInWorkouts := slice }}
          {{ range $.Site.Data.premade_workouts.workouts }}
            {{ $workout := . }}
            {{ range .exercises }}
              {{ if eq (.name | lower) $exerciseTitle }}
                {{ $usedInWorkouts = $usedInWorkouts | append $workout }}
              {{ end }}
            {{ end }}
          {{ end }}
          {{ with $usedInWorkouts }}
          <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm mb-6">
            <h3 class="font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <svg class="w-5 h-5 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
              </svg>
              {{ i18n "used_in_workouts" | default "Used In Workouts" }}
            </h3>
            <ul class="space-y-3">
              {{ range . | first 4 }}
              <li>
                <a href="{{ printf "/workouts/premade/%s/" .id | relLangURL }}" class="flex items-center gap-3 group">
                  <div class="w-10 h-10 rounded-lg flex-shrink-0 flex items-center justify-center
                    {{ if eq .difficulty "beginner" }}bg-green-100 text-green-600{{ end }}
                    {{ if eq .difficulty "intermediate" }}bg-yellow-100 text-yellow-600{{ end }}
                    {{ if eq .difficulty "advanced" }}bg-red-100 text-red-600{{ end }}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/></svg>
                  </div>
                  <div>
                    <span class="text-sm font-medium text-gray-900 group-hover:text-pink-600 transition-colors">{{ .title }}</span>
                    <span class="block text-xs text-gray-500">{{ .duration }} min · {{ .difficulty }}</span>
                  </div>
                </a>
              </li>
              {{ end }}
            </ul>
          </div>
          {{ end }}

          <!-- Related Exercises -->
          {{ $related := .Site.RegularPages.Related . | first 4 }}
          {{ with $related }}
          <div class="bg-white rounded-xl border border-gray-100 p-6 shadow-sm">
            <h3 class="font-semibold text-gray-900 mb-4">{{ i18n "related_exercises" }}</h3>
            <ul class="space-y-3">
              {{ range . }}
              <li>
                <a href="{{ .RelPermalink }}" class="flex items-center gap-3 group">
                  <div class="w-12 h-12 rounded-lg bg-gray-100 overflow-hidden flex-shrink-0">
                    {{ with .Params.image }}
                    <img src="{{ . }}" alt="{{ $.Title }}" class="w-full h-full object-cover">
                    {{ end }}
                  </div>
                  <div>
                    <span class="text-sm font-medium text-gray-900 group-hover:text-pink-600 transition-colors">{{ .Title }}</span>
                    {{ with .Params.difficulty }}
                    <span class="block text-xs text-gray-500">{{ . | title }}</span>
                    {{ end }}
                  </div>
                </a>
              </li>
              {{ end }}
            </ul>
          </div>
          {{ end }}
        </div>
      </aside>
    </div>
  </div>
</article>
{{ end }}
